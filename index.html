<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeScape Planner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f5f7fa;
      color: #333;
      text-align: center;
    }
    header {
      background: #4a90e2;
      color: white;
      padding: 1rem;
      font-size: 1.5rem;
    }
    .calendar-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0 0 0;
    }
    .calendar-controls button {
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .calendar-controls button:hover {
      background: #357abd;
    }
    .calendar-controls span {
      font-size: 1.25rem;
      min-width: 160px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    /* calendar uses the entire viewport width on desktop and mobile */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      padding: 10px;
      /* avoid using full 100vw which can produce horizontal overflow and hide content;
         use a small inset so the calendar is visible on all viewports */
      width: calc(100vw - 32px);
      max-width: 100%;
      margin: 0 auto 12px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.07);
      box-sizing: border-box;
      overflow-x: hidden;
    }
    .calendar-dayname {
      font-weight: bold;
      color: #4a90e2;
      padding-bottom: 4px;
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: default;
    }
    .day {
      background: white;
      border-radius: 6px;
      padding: 10px 6px 6px 6px;
      min-height: 58px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.09);
      cursor: pointer;
      position: relative;
      transition: box-shadow 0.2s;
      overflow: hidden;
    }
    .day.today {
      outline: 2px solid #4a90e2;
    }
    /* remove fixed holiday background to allow dynamic month theme colors */
    .day.holiday {
      color: #c0392b;
      font-weight: bold;
    }
    .day.selected {
      box-shadow: 0 2px 7px 0 #4a90e250;
      border: 2px solid #4a90e2;
    }
    .day .reminder-dot {
      width: 8px; height: 8px;
      background: #e67e22;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      bottom: 8px;
      transform: translateX(-50%);
      display: inline-block;
    }
    .day .event-emoji {
      position: absolute;
      right: 6px;
      top: 6px;
      font-size: 1.1rem;
    }
    .tasks, .dashboard, .events, .reminders {
      margin: 20px;
      text-align: left;
      max-width: 540px;
      margin-left: auto;
      margin-right: auto;
    }
    .tasks h2, .dashboard h2, .events h2, .reminders h2 {
      margin-bottom: 10px;
    }
    /* remove bullets for lists but preserve indentation */
    .tasks ul, .events ul, .reminders ul, .reminder-bar ul, #taskList, #eventList {
      list-style: none;
      margin: 6px 0 0 18px;
      padding: 0;
    }
    /* mobile-only small labels for selects/date/time */
    .mobile-label { display: none; font-weight:600; margin-right:8px; min-width:64px; }
    .mobile-row { display:inline-flex; align-items:center; gap:8px; }
    @media (max-width: 600px) {
      .mobile-label { display:inline-block; }
      .mobile-row input, .mobile-row select { flex: 1 1 auto; }
    }
    .progress {
      margin: 20px auto;
      width: 120px; height: 120px;
      border-radius: 50%;
      border: 10px solid #ddd;
      border-top-color: #4a90e2;
      transition: transform 0.3s ease;
    }
    input[type="text"], select, input[type="date"], input[type="time"] {
      padding: 8px;
      width: 80%;
      margin-bottom: 10px;
      border-radius: 3px;
      border: 1px solid #ccc;
    }
    button {
      padding: 8px 12px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .category-work { color: #e67e22; }
    .category-personal { color: #2ecc71; }
    .category-errands { color: #3498db; }
    .reminder-bar {
      background: #fbeee6;
      border-left: 4px solid #e67e22;
      color: #9a6b16;
      margin: 8px 0 0 0;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.96rem;
    }
    .item-controls { margin-left:8px; }
    .small-btn { padding:4px 6px; font-size:0.9rem; margin-left:6px; background:#888; }
    @media (max-width: 600px) {
      .calendar, .tasks, .dashboard, .reminders { max-width: 100vw; }
    }
    @media (max-width: 600px) {
      .calendar, .tasks, .dashboard, .events, .reminders {
        max-width: calc(100vw - 32px) !important;
        margin-left: auto !important;
        margin-right: auto !important;
        padding-left: 12px;
        padding-right: 12px;
        box-sizing: border-box;
      }
    }
  </style>
</head>
<body>
  <header>üìÖ TimeScape Planner</header>

  <div class="calendar-controls">
    <button onclick="prevMonth()">&lt;</button>
    <span id="monthLabel"></span>
    <button onclick="nextMonth()">&gt;</button>
  </div>
  <section class="calendar" id="calendar"></section>

  <!-- Reminders (grouped with other sections) -->
  <section class="reminders">
    <!-- date H2 goes above the static Reminders header; same size as the header -->
    <div id="reminderHeader">
      <h2 id="reminderDate" style="display:none; margin-bottom:6px;"></h2>
      <h2>‚è∞ Reminders</h2>
    </div>
    <!-- top bars (holiday + events) show directly under the date -->
    <div id="dayTopBars"></div>8px;" class="mobile-row">
    <div id="reminderBar"></div>" for="reminderInput">Reminder</label>
    <div style="margin-bottom:18px;" class="mobile-row">"Add reminder to selected day..." />
      <label class="mobile-label" for="reminderInput">Reminder</label>ne;">Time</label>
      <input type="text" id="reminderInput" placeholder="Add reminder to selected day..." />
      <label class="mobile-label" for="reminderTime" style="display:none;">Time</label>
    </div>el class="mobile-label" for="reminderTime">Time</label>
    <div style="margin-bottom:18px;" class="mobile-row">18%; margin-left:6px;" />
      <label class="mobile-label" for="reminderTime">Time</label>
      <input type="time" id="reminderTime" style="width:18%; margin-left:6px;" />
      <button onclick="addReminder()">Add Reminder</button>
    </div>
  </section>modal for Event / Task / Reminder -->
  <div id="editModal" style="display:none; position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;z-index:9999;">
  <!-- Edit modal for Event / Task / Reminder -->er-radius:8px;max-width:520px;margin:20px auto;box-shadow:0 6px 30px rgba(0,0,0,0.2);">
  <div id="editModal" style="display:none; position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;z-index:9999;">
    <div style="background:#fff;padding:16px;border-radius:8px;max-width:520px;margin:20px auto;box-shadow:0 6px 30px rgba(0,0,0,0.2);">
      <h3 id="editModalHeading">Edit</h3>" />
      <form id="editForm" onsubmit="event.preventDefault(); saveEdit();">
        <input type="hidden" id="editKind" />x" />
        <input type="hidden" id="editEventId" />" />
        <input type="hidden" id="editTaskIndex" />" />
        <input type="hidden" id="editReminderKey" />
        <input type="hidden" id="editReminderIndex" />
          <label style="font-weight:600">Text / Title</label><br/>
        <div style="margin:8px 0;">="text" style="width:100%;padding:8px;margin-top:6px;border:1px solid #ccc;border-radius:4px" />
          <label style="font-weight:600">Text / Title</label><br/>
          <input id="editText" type="text" style="width:100%;padding:8px;margin-top:6px;border:1px solid #ccc;border-radius:4px" />
        </div> style="flex:1">
        <div style="display:flex;gap:8px;">Date</label><br/>
          <div style="flex:1">e" type="date" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
            <label style="font-weight:600">Date</label><br/>
            <input id="editDate" type="date" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
          </div>el style="font-weight:600">Time</label><br/>
          <div style="width:140px">pe="time" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
            <label style="font-weight:600">Time</label><br/>
            <input id="editTime" type="time" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
          </div>"editFieldsExtra" style="margin-top:8px;">
        </div> style="margin-top:8px;">
        <div id="editFieldsExtra" style="margin-top:8px;">><br/>
          <div style="margin-top:8px;">pe="text" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
            <label style="font-weight:600">Location</label><br/>
            <input id="editLocation" type="text" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
          </div> style="flex:1">
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center;">
            <div style="flex:1">ji" type="text" placeholder="üéâ" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
              <label style="font-weight:600">Emoji</label><br/>
              <input id="editEmoji" type="text" placeholder="üéâ" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px" />
            </div>el style="font-weight:600">Category</label><br/>
            <div style="width:140px">y" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px">
              <label style="font-weight:600">Category</label><br/>
              <select id="editCategory" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px">
                <option value="work">work</option>ption>
                <option value="personal">personal</option>
                <option value="errands">errands</option>
              </select>"width:120px">
            </div>el style="font-weight:600">Priority</label><br/>
            <div style="width:120px">y" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px">
              <label style="font-weight:600">Priority</label><br/>
              <select id="editPriority" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px">
                <option value="1">!</option>n>
                <option value="2">!!</option>
                <option value="3">!!!</option>
              </select>
            </div>
          </div>le="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
        </div>ton type="button" onclick="closeEditModal()" style="background:#888;padding:8px 12px;border-radius:6px;color:#fff;border:none">Cancel</button>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">dius:6px;color:#fff;border:none">Save</button>
          <button type="button" onclick="closeEditModal()" style="background:#888;padding:8px 12px;border-radius:6px;color:#fff;border:none">Cancel</button>
          <button type="submit" style="background:#4a90e2;padding:8px 12px;border-radius:6px;color:#fff;border:none">Save</button>
        </div>
      </form>
    </div>
  </div>vents -->
  <section class="events">
  <!-- Events --></h2>
  <section class="events">"eventTitle" placeholder="Event title" />
    <h2>üìÖ Events</h2>-row">
    <input type="text" id="eventTitle" placeholder="Event title" />
    <div class="mobile-row">"eventDate" />
      <label class="mobile-label" for="eventDate">Date</label>
      <input type="date" id="eventDate" />
      <label class="mobile-label" for="eventTime">Time</label>
      <input type="time" id="eventTime" />placeholder="Location" />
    </div> type="text" id="eventEmoji" placeholder="Emoji (e.g. üéâ)" style="width:20%" />
    <input type="text" id="eventLocation" placeholder="Location" />
    <input type="text" id="eventEmoji" placeholder="Emoji (e.g. üéâ)" style="width:20%" />
    <button onclick="addEvent()">Add Event</button>
    <ul id="eventList"></ul>
  </section> -->
  <section class="tasks">
  <!-- Tasks -->/h2>
  <section class="tasks">="newTask" placeholder="Add a task..." />
    <h2>‚úÖ Tasks</h2>Category">
    <input type="text" id="newTask" placeholder="Add a task..." />
    <select id="taskCategory">>Personal</option>
      <option value="work">Work</option>ption>
      <option value="personal">Personal</option>
      <option value="errands">Errands</option>6px;">
    </select>class="mobile-label" for="taskDate">Date</label>
    <div class="mobile-row" style="margin-top:6px;">
      <label class="mobile-label" for="taskDate">Date</label>
      <input type="date" id="taskDate" />
      <label class="mobile-label" for="taskTime">Time</label>
      <input type="time" id="taskTime" />-top:6px;">
    </div>el class="mobile-label" for="taskPriority">Priority</label>
    <div class="mobile-row" style="margin-top:6px;">
      <label class="mobile-label" for="taskPriority">Priority</label>
      <select id="taskPriority">tion>
        <option value="1">!</option>n>
        <option value="2">!!</option>
        <option value="3">!!!</option>
      </select>lick="addTask()">Add</button>
    </div>="taskList"></ul>
    <button onclick="addTask()">Add</button>
    <ul id="taskList"></ul>
  </section>oard -->
  <section class="dashboard">
  <!-- Dashboard --></h2>
  <section class="dashboard">
    <h2>üìä Dashboard</h2> id="progressRing" title="0% complete"></div>
    <p id="summaryStats"></p>
    <div class="progress" id="progressRing" title="0% complete"></div>
  </section>
    // small visible error helper (appears under the header)
  <script>on showAppError(msg) {
    // small visible error helper (appears under the header)
    function showAppError(msg) {
      let el = document.getElementById('appError');
      if (!el) {'appError';
        el = document.createElement('div');
        el.id = 'appError';900';
        el.style.background = '#ffecec';
        el.style.color = '#900';6px';
        el.style.padding = '8px 12px';f5c6cb';
        el.style.margin = '8px 16px';;
        el.style.border = '1px solid #f5c6cb';
        el.style.borderRadius = '6px';elector('header') || document.body;
        el.style.textAlign = 'left';('afterend', el);
        const header = document.querySelector('header') || document.body;
        header.insertAdjacentElement('afterend', el);
      }onsole.warn('App message:', msg);
      el.textContent = msg;
      console.warn('App message:', msg);
    }/ Calendar state
    let selectedMonth, selectedYear, selectedDay = null;
    // Calendar statedocument.getElementById('calendar');
    let selectedMonth, selectedYear, selectedDay = null;el');
    const calendar = document.getElementById('calendar');Bar');
    const monthLabel = document.getElementById('monthLabel');put');
    const reminderBar = document.getElementById('reminderBar'););
    const reminderInput = document.getElementById('reminderInput');
    const reminderTime = document.getElementById('reminderTime');
    const monthNames = [
    // Month namesFebruary", "March", "April", "May", "June",
    const monthNames = ["September", "October", "November", "December"
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"at"];
    ];
    const weekdayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    const themes = [
    // Pastel themes per monthekend: '#e0ccff' }, // Jan
    const themes = [fd6e0', weekend: '#e6ccff' }, // Feb
      { weekday: '#cce5ff', weekend: '#e0ccff' }, // Jan
      { weekday: '#ffd6e0', weekend: '#e6ccff' }, // Feb
      { weekday: '#d6f5d6', weekend: '#cce0ff' }, // Mar
      { weekday: '#fff0b3', weekend: '#ffd9b3' }, // Apr
      { weekday: '#e6ffe6', weekend: '#ccf2ff' }, // May
      { weekday: '#ffe6cc', weekend: '#ffcccc' }, // Jun
      { weekday: '#fff5cc', weekend: '#ffd6cc' }, // Jul
      { weekday: '#e6f7ff', weekend: '#d9e6f2' }, // Aug
      { weekday: '#ffe6b3', weekend: '#ffccb3' }, // Sep
      { weekday: '#ffd9b3', weekend: '#e6ccb3' }, // Oct
      { weekday: '#e6f0ff', weekend: '#d6e6f5' }, // Nov
      { weekday: '#ffcccc', weekend: '#ccffcc' }  // Dec
    ]; Example holidays
    const holidays = {
    // Example holidays"New Year's Day", emoji: 'üéÜ' },
    const holidays = { "Valentine's Day", emoji: '‚ù§Ô∏è' },
      '01-01': { name: "New Year's Day", emoji: 'üéÜ' }, },
      '02-14': { name: "Valentine's Day", emoji: '‚ù§Ô∏è' },,
      '03-17': { name: "St. Patrick's Day", emoji: 'üçÄ' },
      '04-01': { name: "April Fool's Day", emoji: 'ü§°' },
      '07-04': { name: "Independence Day", emoji: 'üéá' },
      '10-31': { name: "Halloween", emoji: 'üéÉ' },
      '12-25': { name: "Christmas Day", emoji: 'üéÖ' }
    }; --- federal holiday helpers (adds Thanksgiving and other common US federal days) --- */
    function computeNthWeekday(year, monthIndex, weekday, n) {
    /* --- federal holiday helpers (adds Thanksgiving and other common US federal days) --- */
    function computeNthWeekday(year, monthIndex, weekday, n) {
      // n = 1..5 for nth occurrence. weekday 0=Sun..6=Sat
      const first = new Date(year, monthIndex, 1);% 7) + (n-1)*7;
      const firstWeekday = first.getDay();
      let day = 1 + ((7 + weekday - firstWeekday) % 7) + (n-1)*7;
      return day;uteLastWeekday(year, monthIndex, weekday) {
    } const last = new Date(year, monthIndex + 1, 0);
    function computeLastWeekday(year, monthIndex, weekday) {
      const last = new Date(year, monthIndex + 1, 0);weekday) % 7);
      const lastWeekday = last.getDay();
      let day = last.getDate() - ((7 + lastWeekday - weekday) % 7);
      return day;uteFederalHolidays(year) {
    } // returns map 'MM-DD' -> {name, emoji}
    function computeFederalHolidays(year) {
      // returns map 'MM-DD' -> {name, emoji}Jan)
      const map = {};computeNthWeekday(year,0,1,3))] = { name: "Martin Luther King Jr. Day", emoji: '‚úä' };
      // Martin Luther King Jr. Day (3rd Mon Jan)
      map['01-'+pad2(computeNthWeekday(year,0,1,3))] = { name: "Martin Luther King Jr. Day", emoji: '‚úä' };
      // Presidents' Day (3rd Mon Feb)
      map['02-'+pad2(computeNthWeekday(year,1,1,3))] = { name: "Presidents' Day", emoji: 'üèõÔ∏è' };
      // Memorial Day (last Mon May)
      map['05-'+pad2(computeLastWeekday(year,4,1))] = { name: "Memorial Day", emoji: 'üéóÔ∏è' };
      // Juneteenth (fixed)rans, Christmas, New Year are already present or fixed; add Labor Day (1st Mon Sep)
      map['06-19'] = { name: "Juneteenth National Independence Day", emoji: 'üè≥Ô∏è‚Äçüåà' };' };
      // Independence, Veterans, Christmas, New Year are already present or fixed; add Labor Day (1st Mon Sep)
      map['09-'+pad2(computeNthWeekday(year,8,1,1))] = { name: "Labor Day", emoji: 'üõ†Ô∏è' };};
      // Columbus Day (2nd Mon Oct)
      map['10-'+pad2(computeNthWeekday(year,9,1,2))] = { name: "Columbus Day", emoji: 'üß≠' };;
      // Thanksgiving (4th Thu Nov)
      map['11-'+pad2(computeNthWeekday(year,10,4,4))] = { name: "Thanksgiving", emoji: 'ü¶É' };
      // Veterans Day (11-11)
      map['11-11'] = { name: "Veterans Day", emoji: 'üéñÔ∏è' };
      return map;oliday(mmdd, year) {
    } // check static list first, then computed federal days for given year
    function getHoliday(mmdd, year) {days[mmdd];
      // check static list first, then computed federal days for given year
      if (holidays[mmdd]) return holidays[mmdd];
      const computed = computeFederalHolidays(year);
      return computed[mmdd] || null;rs --- */
    }
    /* --- end federal holiday helpers --- */' + num : '' + num; }

    function pad2(num) { return num < 10 ? '0' + num : '' + num; }
    // small helper to safely parse localStorage values and recover from corrupted JSON
    // --- STORAGE HELPERS ---key, fallback) {
    // small helper to safely parse localStorage values and recover from corrupted JSON
    function safeParseStorage(key, fallback) {
      try {(!raw) return fallback;
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);age parse failed for', key, err);
      } catch (err) { corrupted entry so future loads are clean
        console.warn('LocalStorage parse failed for', key, err);
        // remove the corrupted entry so future loads are clean
        try { localStorage.removeItem(key); } catch (e) {}
        return fallback;
      }
    }unction getReminders() {
      // stored as { "YYYY-MM-DD": [ {text, time}, ... ] }
    function getReminders() {('reminders', {});
      // stored as { "YYYY-MM-DD": [ {text, time}, ... ] }
      return safeParseStorage('reminders', {});setItem('reminders', JSON.stringify(data)); }
    }
    function setReminders(data) { localStorage.setItem('reminders', JSON.stringify(data)); }
    function setTasks(tasks) { localStorage.setItem('tasks', JSON.stringify(tasks)); }
    function getTasks() { return safeParseStorage('tasks', []); }
    function setTasks(tasks) { localStorage.setItem('tasks', JSON.stringify(tasks)); }
    function setEvents(ev) { localStorage.setItem('events', JSON.stringify(ev)); }
    function getEvents() { return safeParseStorage('events', []); }
    function setEvents(ev) { localStorage.setItem('events', JSON.stringify(ev)); }eded:
    // (() => { localStorage.removeItem('events'); localStorage.removeItem('tasks'); localStorage.removeItem('reminders'); console.info('cleared app storage'); })();
    // quick dev helper: run in the browser console to clear all app storage if needed:
    // (() => { localStorage.removeItem('events'); localStorage.removeItem('tasks'); localStorage.removeItem('reminders'); console.info('cleared app storage'); })();
    function addReminder() {
    // --- REMINDERS ---{ alert('Select a day in the calendar first!'); return; }
    function addReminder() {put.value.trim();
      if (!selectedDay) { alert('Select a day in the calendar first!'); return; }
      const txt = reminderInput.value.trim();
      if (!txt) return;lectedYear}-${pad2(selectedMonth+1)}-${pad2(selectedDay)}`;
      const time = reminderTime.value || '';
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(selectedDay)}`;
      const reminders = getReminders();time });
      if (!reminders[key]) reminders[key] = [];
      reminders[key].push({ text: txt, time });
      setReminders(reminders);
      reminderInput.value = '';);
      reminderTime.value = '';
      showReminders(selectedDay);
      generateCalendar();
    }unction editReminder(day, index) {
      const oldKey = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
    function editReminder(day, index) {
      const oldKey = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();
      const arr = reminders[oldKey] || [];
      const item = arr[index];'editKind').value = 'reminder';
      if (!item) return;tById('editReminderKey').value = oldKey;
      document.getElementById('editKind').value = 'reminder';dex;
      document.getElementById('editReminderKey').value = oldKey;';
      document.getElementById('editReminderIndex').value = index;
      document.getElementById('editText').value = item.text || '';
      // fill date and time; date uses the keye = item.time || '';
      document.getElementById('editDate').value = oldKey || '';
      document.getElementById('editTime').value = item.time || '';
      document.getElementById('editEmoji').value = '';
      showModalFieldsFor('reminder');
      openEditModal('Edit Reminder');
    }unction deleteReminder(day, index) {
      if (!confirm('Delete this reminder?')) return;
    function deleteReminder(day, index) {(selectedMonth+1)}-${pad2(day)}`;
      if (!confirm('Delete this reminder?')) return;
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();delete reminders[key];
      reminders[key].splice(index,1);
      if (reminders[key].length === 0) delete reminders[key];
      setReminders(reminders);
      showReminders(day);
      generateCalendar();
    }/ small helper to produce a full readable date (e.g. "Tuesday, January 14, 2025")
    function formatFullDate(day, monthIndex, year) {
    // small helper to produce a full readable date (e.g. "Tuesday, January 14, 2025")
    function formatFullDate(day, monthIndex, year) {ay: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      const d = new Date(year, monthIndex, day);
      return d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }unction showReminders(day) {
      selectedDay = day;
    function showReminders(day) {
      selectedDay = day;ren].forEach(cell => {
      // Update selected UIcontains('day')) {
      [...calendar.children].forEach(cell => {ay) cell.classList.add('selected');
        if (cell.classList.contains('day')) {contains('day')) {d');
          if (parseInt(cell.dataset.day) === day) cell.classList.add('selected');
          else cell.classList.remove('selected');
        }
      });st key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();(e => e.date === key);
      const items = reminders[key] || [];
      const events = getEvents().filter(e => e.date === key);rs header
      const rd = document.getElementById('reminderDate');
      // put the formatted date into its H2 above the Reminders header);
      const rd = document.getElementById('reminderDate');
      rd.textContent = formatFullDate(day, selectedMonth, selectedYear);
      rd.style.display = 'block';
      const keyMMDD = pad2(selectedMonth+1) + '-' + pad2(day);
      // Holiday info = '';
      const keyMMDD = pad2(selectedMonth+1) + '-' + pad2(day);
      let holidayHTML = '';
      const h = getHoliday(keyMMDD, selectedYear);
      if (h) { class="reminder-bar" style="background:#ffe5e3;border-left:4px solid #c0392b;color:#c0392b;">
        holidayHTML = `i} ${h.name}</b>
          <div class="reminder-bar" style="background:#ffe5e3;border-left:4px solid #c0392b;color:#c0392b;">
            <b>${h.emoji} ${h.name}</b>
          </div>
        `;
      }/ Events (these go into the top bars under the date so edit/delete are visible there)
      let eventsHTML = '';
      // Events (these go into the top bars under the date so edit/delete are visible there)
      let eventsHTML = '';
      if (events.length > 0) {-bar" style="background:#eef6ff;border-left:4px solid #4a90e2;color:#234;">
        eventsHTML = `</b>
          <div class="reminder-bar" style="background:#eef6ff;border-left:4px solid #4a90e2;color:#234;">
            <b>Events:</b>((ev, i) => `<li>${ev.time ? '['+ev.time+'] ' : ''}${ev.emoji ? ev.emoji+' ' : ''}<b>${escapeHTML(ev.title)}</b> ‚Äî ${escapeHTML(ev.location || '')}
            <ul><span class="item-controls">
              ${events.map((ev, i) => `<li>${ev.time ? '['+ev.time+'] ' : ''}${ev.emoji ? ev.emoji+' ' : ''}<b>${escapeHTML(ev.title)}</b> ‚Äî ${escapeHTML(ev.location || '')}
                <span class="item-controls">onclick="deleteEvent(${ev.id})">Delete</button>
                  <button class="small-btn" onclick="editEvent(${ev.id})">Edit</button>
                  <button class="small-btn" onclick="deleteEvent(${ev.id})">Delete</button>
                </span>
              </li>`).join('')}
            </ul>
          </div>
        `;
      }/ Reminders (kept separate below the top bars)
      let remindersHTML = '';
      // Reminders (kept separate below the top bars)in the Reminders section)
      let remindersHTML = '';
      if (items.length > 0) {r-bar">
        remindersHTML = `for ${monthNames[selectedMonth]} ${day}, ${selectedYear}:</b>
          <div class="reminder-bar">
            <b>Reminders for ${monthNames[selectedMonth]} ${day}, ${selectedYear}:</b>r.text)} 
            <ul><span class="item-controls">
              ${items.map((r, i) => `<li>${r.time ? '['+r.time+'] ' : ''}${escapeHTML(r.text)} 
                <span class="item-controls">onclick="deleteReminder(${day},${i})">Delete</button>
                  <button class="small-btn" onclick="editReminder(${day},${i})">Edit</button>
                  <button class="small-btn" onclick="deleteReminder(${day},${i})">Delete</button>
                </span>
              </li>`).join('')}
            </ul>
          </div>
        `;
      }/ render top bars (holiday + events) directly under date, then render reminders below
      document.getElementById('dayTopBars').innerHTML = holidayHTML + eventsHTML;
      // render top bars (holiday + events) directly under date, then render reminders belowy's .day-topbars
      document.getElementById('dayTopBars').innerHTML = holidayHTML + eventsHTML;; });
      reminderBar.innerHTML = remindersHTML;ctorAll('.day')].find(c => parseInt(c.dataset.day,10) === day);
    } if (selCell) {unction generateCalendar() {
        const top = selCell.querySelector('.day-topbars');      // clear and set header
    function generateCalendar() {holidayHTML + eventsHTML;
      // clear and set headeredMonth]} ${selectedYear}`;
      calendar.innerHTML = '';
      monthLabel.textContent = `${monthNames[selectedMonth]} ${selectedYear}`;
    }      for (let d = 0; d < 7; d++) {
      // weekday headersdiv');
      for (let d = 0; d < 7; d++) {-dayname';
        const dayName = document.createElement('div');
        dayName.className = 'calendar-dayname';
        dayName.textContent = weekdayNames[d];electedMonth]} ${selectedYear}`;
        calendar.appendChild(dayName);
      }/ weekday headersonst firstDay = new Date(selectedYear, selectedMonth, 1);
      for (let d = 0; d < 7; d++) {      const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
      const firstDay = new Date(selectedYear, selectedMonth, 1);
      const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
      const startDay = firstDay.getDay();s[d];lYear() === selectedYear && today.getMonth() === selectedMonth;
      const today = new Date();yName);nders();
      const isCurrentMonth = today.getFullYear() === selectedYear && today.getMonth() === selectedMonth;
      const reminders = getReminders();
      const events = getEvents();electedYear, selectedMonth, 1);
      const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();      for (let i = 0; i < startDay; i++) calendar.appendChild(document.createElement('div'));
      // leading blanksfirstDay.getDay();
      for (let i = 0; i < startDay; i++) calendar.appendChild(document.createElement('div'));
      const isCurrentMonth = today.getFullYear() === selectedYear && today.getMonth() === selectedMonth;
      const theme = themes[selectedMonth];ay++) {
      const events = getEvents();        const date = new Date(selectedYear, selectedMonth, day);
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(selectedYear, selectedMonth, day);
        const dayOfWeek = date.getDay(); calendar.appendChild(document.createElement('div'));ear}-${pad2(selectedMonth + 1)}-${pad2(day)}`;
        const keyMMDD = pad2(selectedMonth + 1) + '-' + pad2(day);
        const keyYYYYMMDD = `${selectedYear}-${pad2(selectedMonth + 1)}-${pad2(day)}`;
        cell.className = 'day';
        const cell = document.createElement('div');{
        cell.className = 'day';electedYear, selectedMonth, day);
        cell.dataset.day = day;getDay();ay === today.getDate()) cell.classList.add('today');
        const keyMMDD = pad2(selectedMonth + 1) + '-' + pad2(day);
        if (isCurrentMonth && day === today.getDate()) cell.classList.add('today');}`;
        cell.style.backgroundColor = (dayOfWeek === 0 || dayOfWeek === 6) ? theme.weekend : theme.weekday;
        // theme backgroundnt.createElement('div');
        cell.style.backgroundColor = (dayOfWeek === 0 || dayOfWeek === 6) ? theme.weekend : theme.weekday;
        cell.dataset.day = day;        const h = getHoliday(keyMMDD, selectedYear);
        // holiday or event emoji inline
        const h = getHoliday(keyMMDD, selectedYear);)) cell.classList.add('today');ayEvents[0].emoji || 'üìå') : null;
        const dayEvents = events.filter(e => e.date === keyYYYYMMDD);
        const eventEmoji = dayEvents.length > 0 ? (dayEvents[0].emoji || 'üìå') : null;
        cell.style.backgroundColor = (dayOfWeek === 0 || dayOfWeek === 6) ? theme.weekend : theme.weekday;          cell.classList.add('holiday');
        // Build a consistent internal structure: number area + per-day topbars container
        const numberHtml = hheme.weekend;
          ? `${day} <span style="font-size:1.2em">${h.emoji}</span>`eyMMDD, selectedYear);day} <span style="font-size:1.2em">${h.emoji}</span>`;
          : (eventEmoji ? `${day} <span style="font-size:1.2em">${eventEmoji}</span>` : `${day}`);== keyYYYYMMDD);
        cell.innerHTML = `<div class="day-number">${numberHtml}</div><div class="day-topbars" style="margin-top:6px;"></div>`;l;
        if (h) {>${eventEmoji}</span>`;
          cell.classList.add('holiday');
          cell.title = h.name;
        } else if (eventEmoji) {itle = h.name;
          cell.title = dayEvents.map(e => `${e.time || ''} ${e.title}`).join('\n');lor = theme.weekend;
        } cell.innerHTML = `${day} <span style="font-size:1.2em">${h.emoji}</span>`;/ reminder dot
        } else if (eventEmoji) {        if (reminders[keyYYYYMMDD] && reminders[keyYYYYMMDD].length > 0) {
        // reminder dotdayEvents.map(e => `${e.time || ''} ${e.title}`).join('\n');ocument.createElement('span');
        if (reminders[keyYYYYMMDD] && reminders[keyYYYYMMDD].length > 0) {oji}</span>`;
          const dot = document.createElement('span');
          dot.className = 'reminder-dot';
          // place dot inside the number area
          const num = cell.querySelector('.day-number') || cell;ck = () => showReminders(day);
          num.appendChild(dot);        // reminder dot        if (selectedDay === day) cell.classList.add('selected');
        }keyYYYYMMDD].length > 0) {

        cell.onclick = () => showReminders(day);          dot.className = 'reminder-dot';      }
        if (selectedDay === day) cell.classList.add('selected');
 }
        calendar.appendChild(cell); small-screen layout tweak: keep panels inset from screen edges --- */
      }        cell.onclick = () => showReminders(day);    (function enhanceResponsiveStyles() {
    }

    /* --- small-screen layout tweak: keep panels inset from screen edges --- */
    (function enhanceResponsiveStyles() {ashboard, .events, .reminders {
      // Add an adjusted media rule so panels are not flush to the viewport edge on mobile.
      const css = `
        @media (max-width: 600px) {et from screen edges --- */
          .calendar, .tasks, .dashboard, .events, .reminders {
            max-width: calc(100vw - 32px) !important;els are not flush to the viewport edge on mobile.
            margin-left: auto !important;
            margin-right: auto !important;) {
            padding-left: 12px;oard, .events, .reminders {
            padding-right: 12px; max-width: calc(100vw - 32px) !important;
            box-sizing: border-box;   margin-left: auto !important;st s = document.createElement('style');
          }    margin-right: auto !important;appendChild(document.createTextNode(css));
        }
      `;
      const s = document.createElement('style');
      s.appendChild(document.createTextNode(css)); }- TASKS WITH DATE/TIME/PRIORITY ---
      document.head.appendChild(s);        }    const taskList = document.getElementById('taskList');
    })();

    // --- TASKS WITH DATE/TIME/PRIORITY ---
    const taskList = document.getElementById('taskList');
    const progressRing = document.getElementById('progressRing');    })();      const tasks = getTasks();
    const summaryStats = document.getElementById('summaryStats');
/PRIORITY ---'2': '!!', '3': '!!!' };
    function loadTasks() {getElementById('taskList');ex) => {
      const tasks = getTasks();essRing');
      taskList.innerHTML = '';lementById('summaryStats');ent('input');
      const pmap = { '1': '!', '2': '!!', '3': '!!!' };
      tasks.forEach((task, index) => {
        const li = document.createElement('li'););
        const cb = document.createElement('input');;
        cb.type = 'checkbox';, '2': '!!', '3': '!!!' };b.checked;
        cb.checked = task.done; => {
        cb.onchange = () => {nt('li');
          const all = getTasks();ent.createElement('input');d(all);
          all[index].done = cb.checked;
          setTasks(all);reateElement('span');
          updateProgress(all);.onchange = () => {an.innerHTML = ` ${escapeHTML(task.text)} ${task.date ? '['+task.date+']' : ''} ${task.time ? '['+task.time+']' : ''} Priority:${pmap[task.priority] || task.priority}`;
          updateDashboard(all);
        };
        const span = document.createElement('span');
        span.innerHTML = ` ${escapeHTML(task.text)} ${task.date ? '['+task.date+']' : ''} ${task.time ? '['+task.time+']' : ''} Priority:${pmap[task.priority] || task.priority}`;l);
        span.className = `category-${task.category}`;);ent.createElement('button');
        li.appendChild(cb);        };        editBtn.className = 'small-btn';
        li.appendChild(span);
task.text)} ${task.date ? '['+task.date+']' : ''} ${task.time ? '['+task.time+']' : ''} Priority:${pmap[task.priority] || task.priority}`;(index);
        const editBtn = document.createElement('button');task.category}`;eElement('button');
        editBtn.className = 'small-btn';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editTask(index);
        const delBtn = document.createElement('button');eElement('button');
        delBtn.className = 'small-btn';
        delBtn.textContent = 'Delete';dit';
        delBtn.onclick = () => deleteTask(index); editTask(index););
        li.appendChild(editBtn);        const delBtn = document.createElement('button');      });
        li.appendChild(delBtn);-btn';
elBtn.textContent = 'Delete';ateDashboard(tasks);
        taskList.appendChild(li);=> deleteTask(index);
      });n);
      updateProgress(tasks);   li.appendChild(delBtn);unction addTask() {
      updateDashboard(tasks);      const input = document.getElementById('newTask');
    }hild(li);ocument.getElementById('taskCategory').value;

    function addTask() {
      const input = document.getElementById('newTask');kTime').value || '';
      const category = document.getElementById('taskCategory').value;
      const text = input.value.trim();
      const date = document.getElementById('taskDate').value || '';
      const time = document.getElementById('taskTime').value || '';ment.getElementById('newTask'); category, done:false, date, time, priority });
      const priority = document.getElementById('taskPriority').value || '2';.getElementById('taskCategory').value;
      if (!text) return;value=''; document.getElementById('taskPriority').value='1';
      const tasks = getTasks();ument.getElementById('taskDate').value || '';
      tasks.push({ text, category, done:false, date, time, priority });
      setTasks(tasks);ty = document.getElementById('taskPriority').value || '2';
      input.value=''; document.getElementById('taskDate').value=''; document.getElementById('taskTime').value=''; document.getElementById('taskPriority').value='1'; if (!text) return;unction editTask(index) {
      loadTasks();      const tasks = getTasks();      const tasks = getTasks();
    }ory, done:false, date, time, priority });

    function editTask(index) {t.getElementById('taskDate').value=''; document.getElementById('taskTime').value=''; document.getElementById('taskPriority').value='1';('editKind').value = 'task';
      const tasks = getTasks();tById('editTaskIndex').value = index;
      const t = tasks[index];
      if (!t) return;
      document.getElementById('editKind').value = 'task';
      document.getElementById('editTaskIndex').value = index;
      document.getElementById('editText').value = t.text || '';
      document.getElementById('editDate').value = t.date || '';
      document.getElementById('editTime').value = t.time || '';
      document.getElementById('editCategory').value = t.category || 'work';
      document.getElementById('editPriority').value = t.priority || '2';itText').value = t.text || '';
      document.getElementById('editEmoji').value = ''; // not used for tasksitDate').value = t.date || '';
      showModalFieldsFor('task'); document.getElementById('editTime').value = t.time || '';unction deleteTask(index) {
      openEditModal('Edit Task');      document.getElementById('editCategory').value = t.category || 'work';      if (!confirm('Delete this task?')) return;
    }ditPriority').value = t.priority || '2';
 = ''; // not used for tasks
    function deleteTask(index) {);
      if (!confirm('Delete this task?')) return;sk');
      const tasks = getTasks();
      tasks.splice(index,1);
      setTasks(tasks);unction deleteTask(index) {unction updateProgress(tasks) {
      loadTasks();      if (!confirm('Delete this task?')) return;      const total = tasks.length;
    }ne).length;
nd((done / total) * 100) : 0;
    function updateProgress(tasks) {";
      const total = tasks.length;
      const done = tasks.filter(t => t.done).length;
      const percent = total ? Math.round((done / total) * 100) : 0;
      progressRing.style.borderTopColor = percent === 100 ? "limegreen" : "#4a90e2";
      progressRing.title = percent + "% complete"; const total = tasks.length;unction updateDashboard(tasks) {
      progressRing.style.transform = `rotate(${percent * 3.6}deg)`;      const done = tasks.filter(t => t.done).length;      const total = tasks.length;
    }und((done / total) * 100) : 0;t.done).length;
pColor = percent === 100 ? "limegreen" : "#4a90e2";duce((acc, t) => { acc[t.category] = (acc[t.category] || 0) + 1; return acc; }, {});
    function updateDashboard(tasks) {br>Completed: ${done}<br>Work: ${categories.work || 0}, Personal: ${categories.personal || 0}, Errands: ${categories.errands || 0}`;
      const total = tasks.length;
      const done = tasks.filter(t => t.done).length;
      const categories = tasks.reduce((acc, t) => { acc[t.category] = (acc[t.category] || 0) + 1; return acc; }, {}); EVENTS ---
      summaryStats.innerHTML = `Total tasks: ${total}<br>Completed: ${done}<br>Work: ${categories.work || 0}, Personal: ${categories.personal || 0}, Errands: ${categories.errands || 0}`;    function updateDashboard(tasks) {    const eventList = document.getElementById('eventList');
    }asks.length;ents() {

    // --- EVENTS ---s.reduce((acc, t) => { acc[t.category] = (acc[t.category] || 0) + 1; return acc; }, {});';
    const eventList = document.getElementById('eventList'); `Total tasks: ${total}<br>Completed: ${done}<br>Work: ${categories.work || 0}, Personal: ${categories.personal || 0}, Errands: ${categories.errands || 0}`;
    function renderEvents() {
      const evs = getEvents();: ''}<b>${escapeHTML(e.title)}</b> ‚Äî ${e.date} ${e.time ? '['+e.time+']' : ''} ${e.location ? ' @'+escapeHTML(e.location) : ''}
      eventList.innerHTML = '';
      evs.forEach(e => {
        const li = document.createElement('li');deleteEvent(${e.id})">Delete</button>
        li.innerHTML = `${e.emoji ? e.emoji+' ' : ''}<b>${escapeHTML(e.title)}</b> ‚Äî ${e.date} ${e.time ? '['+e.time+']' : ''} ${e.location ? ' @'+escapeHTML(e.location) : ''}
          <span class="item-controls">
            <button class="small-btn" onclick="editEvent(${e.id})">Edit</button> => {
            <button class="small-btn" onclick="deleteEvent(${e.id})">Delete</button>Element('li');
          </span>`;i.innerHTML = `${e.emoji ? e.emoji+' ' : ''}<b>${escapeHTML(e.title)}</b> ‚Äî ${e.date} ${e.time ? '['+e.time+']' : ''} ${e.location ? ' @'+escapeHTML(e.location) : ''}
        eventList.appendChild(li);     <span class="item-controls">unction addEvent() {
      });            <button class="small-btn" onclick="editEvent(${e.id})">Edit</button>      const title = document.getElementById('eventTitle').value.trim();
    }="small-btn" onclick="deleteEvent(${e.id})">Delete</button>nt.getElementById('eventDate').value;

    function addEvent() {
      const title = document.getElementById('eventTitle').value.trim();
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value || '';
      const location = document.getElementById('eventLocation').value.trim();
      const emoji = document.getElementById('eventEmoji').value.trim();etElementById('eventTitle').value.trim();te: date, time, location, emoji });
      if (!title || !date) { alert('Event needs a title and date'); return; }
      const evs = getEvents();'';tElementById('eventDate').value=''; document.getElementById('eventTime').value=''; document.getElementById('eventLocation').value=''; document.getElementById('eventEmoji').value='';
      const id = evs.length ? Math.max(...evs.map(e=>e.id)) + 1 : 1;= document.getElementById('eventLocation').value.trim();
      evs.push({ id, title, date: date, time, location, emoji });
      setEvents(evs);date) { alert('Event needs a title and date'); return; }
      document.getElementById('eventTitle').value=''; document.getElementById('eventDate').value=''; document.getElementById('eventTime').value=''; document.getElementById('eventLocation').value=''; document.getElementById('eventEmoji').value='';ts();
      renderEvents(); const id = evs.length ? Math.max(...evs.map(e=>e.id)) + 1 : 1;unction editEvent(id) {
      generateCalendar();      evs.push({ id, title, date: date, time, location, emoji });      const evs = getEvents();
    }> e.id === id);
'eventTitle').value=''; document.getElementById('eventDate').value=''; document.getElementById('eventTime').value=''; document.getElementById('eventLocation').value=''; document.getElementById('eventEmoji').value='';
    function editEvent(id) {
      const evs = getEvents();
      const idx = evs.findIndex(e => e.id === id);ue = 'event';
      if (idx === -1) return;alue = id;
      const e = evs[idx];
      // populate modal
      document.getElementById('editKind').value = 'event';
      document.getElementById('editEventId').value = id;
      document.getElementById('editText').value = e.title || '';
      document.getElementById('editDate').value = e.date || '';
      document.getElementById('editTime').value = e.time || '';
      document.getElementById('editLocation').value = e.location || '';lue = id;
      document.getElementById('editEmoji').value = e.emoji || '';tText').value = e.title || '';
      // show/hide fields appropriate for eventtDate').value = e.date || '';
      showModalFieldsFor('event'); document.getElementById('editTime').value = e.time || '';unction deleteEvent(id) {
      openEditModal('Edit Event');      document.getElementById('editLocation').value = e.location || '';      if (!confirm('Delete this event?')) return;
    }'editEmoji').value = e.emoji || '';

    function deleteEvent(id) {ent');
      if (!confirm('Delete this event?')) return;
      let evs = getEvents();
      evs = evs.filter(e=>e.id!==id);tedDay);
      setEvents(evs);id) {
      renderEvents();
      generateCalendar(); let evs = getEvents();/ --- UTILITIES ---
      if (selectedDay) showReminders(selectedDay);      evs = evs.filter(e=>e.id!==id);    function escapeHTML(s) {
    }(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

    // --- UTILITIES ---
    function escapeHTML(s) { if (selectedDay) showReminders(selectedDay);/ show errors early (helps if a runtime error prevented calendar from rendering)
      return (s+'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));    }    window.addEventListener('error', function (e) {
    }

    // show errors early (helps if a runtime error prevented calendar from rendering)
    window.addEventListener('error', function (e) {'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      console.error('Runtime error:', e.error || e.message);
      // non-intrusive visible hint for development
      const el = document.createElement('div');ps if a runtime error prevented calendar from rendering)#fdd';
      el.style.position = 'fixed';ror', function (e) {
      el.style.left = '12px';', e.error || e.message);
      el.style.bottom = '12px'; hint for developmentolid #c00';
      el.style.background = '#fdd';eElement('div');
      el.style.color = '#600';? e.error.message : e.message);
      el.style.padding = '8px';ld(el);
      el.style.border = '1px solid #c00';
      el.style.zIndex = 9999;
      el.textContent = 'App error: ' + (e.error ? e.error.message : e.message);l.style.color = '#600';navigation helpers (restore prev/next buttons)
      document.body.appendChild(el);      el.style.padding = '8px';    function prevMonth() {
    });
99;0) { selectedMonth = 11; selectedYear--; }
    // navigation helpers (restore prev/next buttons) 'App error: ' + (e.error ? e.error.message : e.message);();
    function prevMonth() {
      selectedMonth--; 1, new Date(selectedYear, selectedMonth + 1, 0).getDate());
      if (selectedMonth < 0) { selectedMonth = 11; selectedYear--; }
      generateCalendar();
      // reset selectedDay to 1 for clarity, then show if valid
      selectedDay = Math.min(selectedDay || 1, new Date(selectedYear, selectedMonth + 1, 0).getDate()); selectedMonth--; selectedMonth++;
      showReminders(selectedDay);0) { selectedMonth = 11; selectedYear--; }11) { selectedMonth = 0; selectedYear++; }
    }();();
    function nextMonth() {ectedMonth + 1, 0).getDate());
      selectedMonth++;min(selectedDay || 1, new Date(selectedYear, selectedMonth + 1, 0).getDate());tedDay);
      if (selectedMonth > 11) { selectedMonth = 0; selectedYear++; }
      generateCalendar();
      selectedDay = Math.min(selectedDay || 1, new Date(selectedYear, selectedMonth + 1, 0).getDate());unction nextMonth() {/ modal helpers
      showReminders(selectedDay);      selectedMonth++;    function openEditModal(title) {
    }nth > 11) { selectedMonth = 0; selectedYear++; }ementById('editModalHeading').textContent = title;
yle.display = 'flex';
    // modal helpersselectedMonth + 1, 0).getDate());
    function openEditModal(title) {
      document.getElementById('editModalHeading').textContent = title; document.getElementById('editModal').style.display = 'none';
      document.getElementById('editModal').style.display = 'flex';
    }
    function closeEditModal() {unction openEditModal(title) {unction showModalFieldsFor(kind) {
      document.getElementById('editModal').style.display = 'none';      document.getElementById('editModalHeading').textContent = title;      // always show text/date/time; show extras per kind
    }l').style.display = 'flex';Id('editLocation');

    function showModalFieldsFor(kind) {
      // always show text/date/time; show extras per kind= 'none';ity');
      const loc = document.getElementById('editLocation');
      const emoji = document.getElementById('editEmoji');
      const category = document.getElementById('editCategory');or(kind) {tyle.display = 'block';
      const priority = document.getElementById('editPriority');er kindne';
      if (kind === 'event') {ion');';
        loc.parentElement.style.display = 'block';');
        emoji.parentElement.style.display = 'block';tegory');
        category.parentElement.style.display = 'none';ElementById('editPriority');isplay = 'none';
        priority.parentElement.style.display = 'none';
      } else if (kind === 'task') {k';
        loc.parentElement.style.display = 'none';
        emoji.parentElement.style.display = 'none';
        category.parentElement.style.display = 'block';splay = 'none';ay = 'none';
        priority.parentElement.style.display = 'block';
      } else if (kind === 'reminder') {;
        loc.parentElement.style.display = 'none';
        emoji.parentElement.style.display = 'none';;
        category.parentElement.style.display = 'none'; priority.parentElement.style.display = 'block';
        priority.parentElement.style.display = 'none'; } else if (kind === 'reminder') {unction saveEdit() {
      }        loc.parentElement.style.display = 'none';      const kind = document.getElementById('editKind').value;
    }nt.style.display = 'none';nt.getElementById('editText').value.trim();

    function saveEdit() {
      const kind = document.getElementById('editKind').value;
      const text = document.getElementById('editText').value.trim();
      const date = document.getElementById('editDate').value;
      const time = document.getElementById('editTime').value || '';
      if (kind === 'event') {lementById('editKind').value;ditModal(); return; }
        const id = parseInt(document.getElementById('editEventId').value,10);').value.trim();
        const evs = getEvents();).value;
        const idx = evs.findIndex(e => e.id === id);tElementById('editTime').value || '';
        if (idx === -1) { closeEditModal(); return; }ocument.getElementById('editLocation').value.trim();
        evs[idx].title = text;ocument.getElementById('editEventId').value,10);ment.getElementById('editEmoji').value.trim();
        evs[idx].date = date;
        evs[idx].time = time;
        evs[idx].location = document.getElementById('editLocation').value.trim(); { closeEditModal(); return; }r();
        evs[idx].emoji = document.getElementById('editEmoji').value.trim();= text;) showReminders(selectedDay);
        setEvents(evs);e;task') {
        renderEvents();,10);
        generateCalendar();t.getElementById('editLocation').value.trim();
        if (selectedDay) showReminders(selectedDay);
      } else if (kind === 'task') {
        const idx = parseInt(document.getElementById('editTaskIndex').value,10);
        const tasks = getTasks();
        if (!tasks[idx]) { closeEditModal(); return; }minders(selectedDay);ocument.getElementById('editCategory').value;
        tasks[idx].text = text;') {ocument.getElementById('editPriority').value;
        tasks[idx].date = date;10);
        tasks[idx].time = time;
        tasks[idx].category = document.getElementById('editCategory').value; { closeEditModal(); return; }= 'reminder') {
        tasks[idx].priority = document.getElementById('editPriority').value;ext = text;y = document.getElementById('editReminderKey').value;
        setTasks(tasks);ntById('editReminderIndex').value,10);
        loadTasks();
      } else if (kind === 'reminder') {
        const origKey = document.getElementById('editReminderKey').value;tElementById('editPriority').value;
        const ridx = parseInt(document.getElementById('editReminderIndex').value,10);
        const reminders = getReminders();
        const arr = reminders[origKey] || [];
        const item = arr[ridx];entById('editReminderKey').value;
        if (!item) { closeEditModal(); return; }Int(document.getElementById('editReminderIndex').value,10); 0) delete reminders[origKey];
        const newDate = date || origKey;etReminders();ewDate;
        // remove original
        arr.splice(ridx,1);ext, time });
        if (arr.length === 0) delete reminders[origKey];
        const targetKey = newDate;
        if (!reminders[targetKey]) reminders[targetKey] = [];'-');
        reminders[targetKey].push({ text, time });
        setReminders(reminders);ers[origKey];10);
        // update selection & UI;t(parts[1],10) - 1;
        const parts = targetKey.split('-');rgetKey] = [];
        if (parts.length === 3) {
          selectedYear = parseInt(parts[0],10);
          selectedMonth = parseInt(parts[1],10) - 1;/ update selection & UIhowReminders(selectedDay);
          selectedDay = parseInt(parts[2],10);tKey.split('-');
        }
        generateCalendar();   selectedYear = parseInt(parts[0],10);
        showReminders(selectedDay); = parseInt(parts[1],10) - 1;
      }     selectedDay = parseInt(parts[2],10);/ Init
      closeEditModal();        }    (function init() {
    }erateCalendar(); now = new Date();
selectedDay);now.getMonth();
    // Init
    (function init() {
      const now = new Date();
      selectedMonth = now.getMonth();
      selectedYear = now.getFullYear();    // Init        showAppError('Initialization failed: missing DOM elements (calendar or month label).');
      selectedDay = now.getDate();

      if (!calendar || !monthLabel) {onth = now.getMonth();
        showAppError('Initialization failed: missing DOM elements (calendar or month label).');electedYear = now.getFullYear();ry {
        return;      selectedDay = now.getDate();        generateCalendar();
      }
thLabel) {rateCalendar error', err);
      try {'Initialization failed: missing DOM elements (calendar or month label).');'Error generating calendar: ' + (err && err.message || err));
        generateCalendar();
      } catch (err) {
        console.error('generateCalendar error', err);
        showAppError('Error generating calendar: ' + (err && err.message || err));ry {ry {
        return;        generateCalendar();        showReminders(selectedDay);
      }ch (err) {ch (err) {
ndar error', err);s error', err);
      try {'Error generating calendar: ' + (err && err.message || err));'Error showing reminders: ' + (err && err.message || err));
        showReminders(selectedDay);
      } catch (err) {
        console.error('showReminders error', err);
        showAppError('Error showing reminders: ' + (err && err.message || err));      try {        loadTasks();
      }wReminders(selectedDay);ch (err) {
{r('loadTasks error', err);
      try {('showReminders error', err);'Error loading tasks: ' + (err && err.message || err));
        loadTasks(); ' + (err && err.message || err));
      } catch (err) {
        console.error('loadTasks error', err);
        showAppError('Error loading tasks: ' + (err && err.message || err));      try {        renderEvents();
      }dTasks();ch (err) {
nderEvents error', err);
      try {('loadTasks error', err);'Error rendering events: ' + (err && err.message || err));
        renderEvents();rr && err.message || err));
      } catch (err) {
        console.error('renderEvents error', err);
        showAppError('Error rendering events: ' + (err && err.message || err)); {
      }derEvents();
    })(); catch (err) {        console.error('renderEvents error', err);        showAppError('Error rendering events: ' + (err && err.message || err));
  </script>
</body>    })();


</html>  </script>
</body>
</html>
