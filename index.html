<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeScape Planner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f5f7fa;
      color: #333;
      text-align: center;
    }
    header {
      background: #4a90e2;
      color: white;
      padding: 1rem;
      font-size: 1.5rem;
    }
    .calendar-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0 0 0;
    }
    .calendar-controls button {
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .calendar-controls button:hover {
      background: #357abd;
    }
    .calendar-controls span {
      font-size: 1.25rem;
      min-width: 160px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      padding: 10px 10px 0 10px;
      max-width: 540px;
      margin: 0 auto 12px auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.07);
    }
    .calendar-dayname {
      font-weight: bold;
      color: #4a90e2;
      padding-bottom: 4px;
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: default;
    }
    .day {
      background: white;
      border-radius: 6px;
      padding: 10px 6px 6px 6px;
      min-height: 58px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.09);
      cursor: pointer;
      position: relative;
      transition: box-shadow 0.2s;
      overflow: hidden;
    }
    .day.today {
      outline: 2px solid #4a90e2;
    }
    /* remove fixed holiday background to allow dynamic month theme colors */
    .day.holiday {
      color: #c0392b;
      font-weight: bold;
    }
    .day.selected {
      box-shadow: 0 2px 7px 0 #4a90e250;
      border: 2px solid #4a90e2;
    }
    .day .reminder-dot {
      width: 8px; height: 8px;
      background: #e67e22;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      bottom: 8px;
      transform: translateX(-50%);
      display: inline-block;
    }
    .day .event-emoji {
      position: absolute;
      right: 6px;
      top: 6px;
      font-size: 1.1rem;
    }
    .tasks, .dashboard, .events {
      margin: 20px;
      text-align: left;
      max-width: 540px;
      margin-left: auto;
      margin-right: auto;
    }
    .tasks h2, .dashboard h2, .events h2 {
      margin-bottom: 10px;
    }
    .progress {
      margin: 20px auto;
      width: 120px; height: 120px;
      border-radius: 50%;
      border: 10px solid #ddd;
      border-top-color: #4a90e2;
      transition: transform 0.3s ease;
    }
    input[type="text"], select, input[type="date"], input[type="time"] {
      padding: 8px;
      width: 80%;
      margin-bottom: 10px;
      border-radius: 3px;
      border: 1px solid #ccc;
    }
    button {
      padding: 8px 12px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .category-work { color: #e67e22; }
    .category-personal { color: #2ecc71; }
    .category-errands { color: #3498db; }
    .reminder-bar {
      background: #fbeee6;
      border-left: 4px solid #e67e22;
      color: #9a6b16;
      margin: 8px 0 0 0;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.96rem;
    }
    .item-controls { margin-left:8px; }
    .small-btn { padding:4px 6px; font-size:0.9rem; margin-left:6px; background:#888; }
    @media (max-width: 600px) {
      .calendar, .tasks, .dashboard { max-width: 100vw; }
    }
  </style>
</head>
<body>
  <header>üìÖ TimeScape Planner</header>

  <div class="calendar-controls">
    <button onclick="prevMonth()">&lt;</button>
    <span id="monthLabel"></span>
    <button onclick="nextMonth()">&gt;</button>
  </div>
  <section class="calendar" id="calendar"></section>

  <!-- Reminders for Selected Day -->
  <div id="reminderBar"></div>
  <div style="margin-bottom:18px;">
    <input type="text" id="reminderInput" placeholder="Add reminder to selected day..." />
    <input type="time" id="reminderTime" style="width:18%; margin-left:6px;" />
    <button onclick="addReminder()">Add Reminder</button>
  </div>

  <!-- Events -->
  <section class="events">
    <h2>üìÖ Events</h2>
    <input type="text" id="eventTitle" placeholder="Event title" />
    <input type="date" id="eventDate" />
    <input type="time" id="eventTime" />
    <input type="text" id="eventLocation" placeholder="Location" />
    <input type="text" id="eventEmoji" placeholder="Emoji (e.g. üéâ)" style="width:20%" />
    <button onclick="addEvent()">Add Event</button>
    <ul id="eventList"></ul>
  </section>

  <!-- Tasks -->
  <section class="tasks">
    <h2>‚úÖ Tasks</h2>
    <input type="text" id="newTask" placeholder="Add a task..." />
    <select id="taskCategory">
      <option value="work">Work</option>
      <option value="personal">Personal</option>
      <option value="errands">Errands</option>
    </select>
    <input type="date" id="taskDate" />
    <input type="time" id="taskTime" />
    <select id="taskPriority">
      <option value="1">Priority 1</option>
      <option value="2">Priority 2</option>
      <option value="3">Priority 3</option>
    </select>
    <button onclick="addTask()">Add</button>
    <ul id="taskList"></ul>
  </section>

  <!-- Dashboard -->
  <section class="dashboard">
    <h2>üìä Dashboard</h2>
    <p id="summaryStats"></p>
    <div class="progress" id="progressRing" title="0% complete"></div>
  </section>

  <script>
    // Calendar state
    let selectedMonth, selectedYear, selectedDay = null;
    const calendar = document.getElementById('calendar');
    const monthLabel = document.getElementById('monthLabel');
    const reminderBar = document.getElementById('reminderBar');
    const reminderInput = document.getElementById('reminderInput');
    const reminderTime = document.getElementById('reminderTime');

    // Month names
    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    const weekdayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    // Pastel themes per month
    const themes = [
      { weekday: '#cce5ff', weekend: '#e0ccff' }, // Jan
      { weekday: '#ffd6e0', weekend: '#e6ccff' }, // Feb
      { weekday: '#d6f5d6', weekend: '#cce0ff' }, // Mar
      { weekday: '#fff0b3', weekend: '#ffd9b3' }, // Apr
      { weekday: '#e6ffe6', weekend: '#ccf2ff' }, // May
      { weekday: '#ffe6cc', weekend: '#ffcccc' }, // Jun
      { weekday: '#fff5cc', weekend: '#ffd6cc' }, // Jul
      { weekday: '#e6f7ff', weekend: '#d9e6f2' }, // Aug
      { weekday: '#ffe6b3', weekend: '#ffccb3' }, // Sep
      { weekday: '#ffd9b3', weekend: '#e6ccb3' }, // Oct
      { weekday: '#e6f0ff', weekend: '#d6e6f5' }, // Nov
      { weekday: '#ffcccc', weekend: '#ccffcc' }  // Dec
    ];

    // Example holidays
    const holidays = {
      '01-01': { name: "New Year's Day", emoji: 'üéÜ' },
      '02-14': { name: "Valentine's Day", emoji: '‚ù§Ô∏è' },
      '03-17': { name: "St. Patrick's Day", emoji: 'üçÄ' },
      '04-01': { name: "April Fool's Day", emoji: 'ü§°' },
      '07-04': { name: "Independence Day", emoji: 'üéá' },
      '10-31': { name: "Halloween", emoji: 'üéÉ' },
      '12-25': { name: "Christmas Day", emoji: 'üéÖ' }
    };

    function pad2(num) { return num < 10 ? '0' + num : '' + num; }

    // --- STORAGE HELPERS ---
    function getReminders() {
      // stored as { "YYYY-MM-DD": [ {text, time}, ... ] }
      return JSON.parse(localStorage.getItem('reminders') || '{}');
    }
    function setReminders(data) { localStorage.setItem('reminders', JSON.stringify(data)); }

    function getTasks() { return JSON.parse(localStorage.getItem('tasks') || '[]'); }
    function setTasks(tasks) { localStorage.setItem('tasks', JSON.stringify(tasks)); }

    function getEvents() { return JSON.parse(localStorage.getItem('events') || '[]'); }
    function setEvents(ev) { localStorage.setItem('events', JSON.stringify(ev)); }

    // --- REMINDERS ---
    function addReminder() {
      if (!selectedDay) { alert('Select a day in the calendar first!'); return; }
      const txt = reminderInput.value.trim();
      if (!txt) return;
      const time = reminderTime.value || '';
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(selectedDay)}`;
      const reminders = getReminders();
      if (!reminders[key]) reminders[key] = [];
      reminders[key].push({ text: txt, time });
      setReminders(reminders);
      reminderInput.value = '';
      reminderTime.value = '';
      showReminders(selectedDay);
      generateCalendar();
    }

    function editReminder(day, index) {
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();
      const item = reminders[key][index];
      const newText = prompt('Edit reminder text:', item.text);
      if (newText === null) return;
      const newTime = prompt('Edit time (HH:MM, leave blank for none):', item.time || '');
      if (newTime === null) return;
      reminders[key][index] = { text: newText.trim(), time: newTime.trim() };
      setReminders(reminders);
      showReminders(day);
      generateCalendar();
    }

    function deleteReminder(day, index) {
      if (!confirm('Delete this reminder?')) return;
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();
      reminders[key].splice(index,1);
      if (reminders[key].length === 0) delete reminders[key];
      setReminders(reminders);
      showReminders(day);
      generateCalendar();
    }

    function showReminders(day) {
      selectedDay = day;
      // Update selected UI
      [...calendar.children].forEach(cell => {
        if (cell.classList.contains('day')) {
          if (parseInt(cell.dataset.day) === day) cell.classList.add('selected');
          else cell.classList.remove('selected');
        }
      });
      const key = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
      const reminders = getReminders();
      const items = reminders[key] || [];

      // Events that day
      const events = getEvents().filter(e => e.date === key);

      // Holiday info
      const keyMMDD = pad2(selectedMonth+1) + '-' + pad2(day);
      let holidayHTML = '';
      if (holidays[keyMMDD]) {
        const h = holidays[keyMMDD];
        holidayHTML = `
          <div class="reminder-bar" style="background:#ffe5e3;border-left:4px solid #c0392b;color:#c0392b;">
            <b>${h.emoji} ${h.name}</b>
          </div>
        `;
      }

      let remindersHTML = '';
      if (items.length > 0) {
        remindersHTML = `
          <div class="reminder-bar">
            <b>Reminders for ${monthNames[selectedMonth]} ${day}, ${selectedYear}:</b>
            <ul style="margin:6px 0 0 18px;padding:0;">
              ${items.map((r, i) => `<li>${r.time ? '['+r.time+'] ' : ''}${escapeHTML(r.text)} 
                <span class="item-controls">
                  <button class="small-btn" onclick="editReminder(${day},${i})">Edit</button>
                  <button class="small-btn" onclick="deleteReminder(${day},${i})">Delete</button>
                </span>
              </li>`).join('')}
            </ul>
          </div>
        `;
      }

      let eventsHTML = '';
      if (events.length > 0) {
        eventsHTML = `
          <div class="reminder-bar" style="background:#eef6ff;border-left:4px solid #4a90e2;color:#234;">
            <b>Events:</b>
            <ul style="margin:6px 0 0 18px;padding:0;">
              ${events.map((ev, i) => `<li>${ev.time ? '['+ev.time+'] ' : ''}${ev.emoji ? ev.emoji+' ' : ''}<b>${escapeHTML(ev.title)}</b> ‚Äî ${escapeHTML(ev.location || '')}
                <span class="item-controls">
                  <button class="small-btn" onclick="editEvent(${ev.id})">Edit</button>
                  <button class="small-btn" onclick="deleteEvent(${ev.id})">Delete</button>
                </span>
              </li>`).join('')}
            </ul>
          </div>
        `;
      }

      reminderBar.innerHTML = holidayHTML + remindersHTML + eventsHTML;
    }

    // --- CALENDAR GENERATION ---
    function generateCalendar() {
      calendar.innerHTML = '';
      monthLabel.textContent = `${monthNames[selectedMonth]} ${selectedYear}`;

      for (let d = 0; d < 7; d++) {
        const dayName = document.createElement('div');
        dayName.className = 'calendar-dayname';
        dayName.textContent = weekdayNames[d];
        calendar.appendChild(dayName);
      }

      const firstDay = new Date(selectedYear, selectedMonth, 1);
      const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
      const startDay = firstDay.getDay();
      const today = new Date();
      const isCurrentMonth = today.getFullYear() === selectedYear && today.getMonth() === selectedMonth;
      const reminders = getReminders();
      const events = getEvents();

      for (let i = 0; i < startDay; i++) calendar.appendChild(document.createElement('div'));

      const theme = themes[selectedMonth];
      for (let day=1; day<=daysInMonth; day++) {
        const date = new Date(selectedYear, selectedMonth, day);
        const dayOfWeek = date.getDay();
        const keyMMDD = pad2(selectedMonth+1) + '-' + pad2(day);
        const keyYYYYMMDD = `${selectedYear}-${pad2(selectedMonth+1)}-${pad2(day)}`;
        const cell = document.createElement('div');
        cell.className = 'day';
        cell.dataset.day = day;

        if (isCurrentMonth && day === today.getDate()) cell.classList.add('today');

        // theme color
        if (dayOfWeek === 0 || dayOfWeek === 6) cell.style.backgroundColor = theme.weekend;
        else cell.style.backgroundColor = theme.weekday;

        // Holiday highlight
        if (holidays[keyMMDD]) {
          const h = holidays[keyMMDD];
          cell.classList.add('holiday');
          cell.title = h.name;
          // ensure holiday matches weekend theme color
          cell.style.backgroundColor = theme.weekend;
          cell.innerHTML = `${day} <span style="font-size:1.2em">${h.emoji}</span>`;
        } else {
          cell.textContent = day;
        }

        // event emoji preview (first event)
        const dayEvents = events.filter(e => e.date === keyYYYYMMDD);
        if (dayEvents.length > 0) {
          const emojiSpan = document.createElement('span');
          emojiSpan.className = 'event-emoji';
          emojiSpan.title = dayEvents.map(e => `${e.time || ''} ${e.title}`).join('\n');
          emojiSpan.textContent = dayEvents[0].emoji || 'üìå';
          cell.appendChild(emojiSpan);
        }

        // Dot if reminders
        if (reminders[keyYYYYMMDD] && reminders[keyYYYYMMDD].length > 0) {
          const dot = document.createElement('span');
          dot.className = 'reminder-dot';
          cell.appendChild(dot);
        }

        cell.onclick = () => showReminders(day);
        if (selectedDay === day) cell.classList.add('selected');
        calendar.appendChild(cell);
      }
    }

    function prevMonth() {
      if (selectedMonth === 0) { selectedMonth = 11; selectedYear--; } else selectedMonth--;
      selectedDay = null; reminderBar.innerHTML = ''; generateCalendar();
    }
    function nextMonth() {
      if (selectedMonth === 11) { selectedMonth = 0; selectedYear++; } else selectedMonth++;
      selectedDay = null; reminderBar.innerHTML = ''; generateCalendar();
    }

    // --- TASKS WITH DATE/TIME/PRIORITY ---
    const taskList = document.getElementById('taskList');
    const progressRing = document.getElementById('progressRing');
    const summaryStats = document.getElementById('summaryStats');

    function loadTasks() {
      const tasks = getTasks();
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const li = document.createElement('li');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = task.done;
        cb.onchange = () => {
          const all = getTasks();
          all[index].done = cb.checked;
          setTasks(all);
          updateProgress(all);
          updateDashboard(all);
        };
        const span = document.createElement('span');
        span.innerHTML = ` ${escapeHTML(task.text)} ${task.date ? '['+task.date+']' : ''} ${task.time ? '['+task.time+']' : ''} Priority:${task.priority}`;
        span.className = `category-${task.category}`;
        li.appendChild(cb);
        li.appendChild(span);

        const editBtn = document.createElement('button');
        editBtn.className = 'small-btn';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editTask(index);
        const delBtn = document.createElement('button');
        delBtn.className = 'small-btn';
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => deleteTask(index);
        li.appendChild(editBtn);
        li.appendChild(delBtn);

        taskList.appendChild(li);
      });
      updateProgress(tasks);
      updateDashboard(tasks);
    }

    function addTask() {
      const input = document.getElementById('newTask');
      const category = document.getElementById('taskCategory').value;
      const text = input.value.trim();
      const date = document.getElementById('taskDate').value || '';
      const time = document.getElementById('taskTime').value || '';
      const priority = document.getElementById('taskPriority').value || '2';
      if (!text) return;
      const tasks = getTasks();
      tasks.push({ text, category, done:false, date, time, priority });
      setTasks(tasks);
      input.value=''; document.getElementById('taskDate').value=''; document.getElementById('taskTime').value=''; document.getElementById('taskPriority').value='1';
      loadTasks();
    }

    function editTask(index) {
      const tasks = getTasks();
      const t = tasks[index];
      const newText = prompt('Edit task text:', t.text);
      if (newText === null) return;
      const newDate = prompt('Date (YYYY-MM-DD) or empty:', t.date || '');
      if (newDate === null) return;
      const newTime = prompt('Time (HH:MM) or empty:', t.time || '');
      if (newTime === null) return;
      const newPriority = prompt('Priority (1-3):', t.priority || '2');
      if (newPriority === null) return;
      t.text = newText.trim();
      t.date = newDate.trim();
      t.time = newTime.trim();
      t.priority = ['1','2','3'].includes(newPriority) ? newPriority : '2';
      setTasks(tasks);
      loadTasks();
    }

    function deleteTask(index) {
      if (!confirm('Delete this task?')) return;
      const tasks = getTasks();
      tasks.splice(index,1);
      setTasks(tasks);
      loadTasks();
    }

    function updateProgress(tasks) {
      const total = tasks.length;
      const done = tasks.filter(t => t.done).length;
      const percent = total ? Math.round((done / total) * 100) : 0;
      progressRing.style.borderTopColor = percent === 100 ? "limegreen" : "#4a90e2";
      progressRing.title = percent + "% complete";
      progressRing.style.transform = `rotate(${percent * 3.6}deg)`;
    }

    function updateDashboard(tasks) {
      const total = tasks.length;
      const done = tasks.filter(t => t.done).length;
      const categories = tasks.reduce((acc, t) => { acc[t.category] = (acc[t.category] || 0) + 1; return acc; }, {});
      summaryStats.innerHTML = `Total tasks: ${total}<br>Completed: ${done}<br>Work: ${categories.work || 0}, Personal: ${categories.personal || 0}, Errands: ${categories.errands || 0}`;
    }

    // --- EVENTS ---
    const eventList = document.getElementById('eventList');
    function renderEvents() {
      const evs = getEvents();
      eventList.innerHTML = '';
      evs.forEach(e => {
        const li = document.createElement('li');
        li.innerHTML = `${e.emoji ? e.emoji+' ' : ''}<b>${escapeHTML(e.title)}</b> ‚Äî ${e.date} ${e.time ? '['+e.time+']' : ''} ${e.location ? ' @'+escapeHTML(e.location) : ''}
          <span class="item-controls">
            <button class="small-btn" onclick="editEvent(${e.id})">Edit</button>
            <button class="small-btn" onclick="deleteEvent(${e.id})">Delete</button>
          </span>`;
        eventList.appendChild(li);
      });
    }

    function addEvent() {
      const title = document.getElementById('eventTitle').value.trim();
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value || '';
      const location = document.getElementById('eventLocation').value.trim();
      const emoji = document.getElementById('eventEmoji').value.trim();
      if (!title || !date) { alert('Event needs a title and date'); return; }
      const evs = getEvents();
      const id = evs.length ? Math.max(...evs.map(e=>e.id)) + 1 : 1;
      evs.push({ id, title, date: date, time, location, emoji });
      setEvents(evs);
      document.getElementById('eventTitle').value=''; document.getElementById('eventDate').value=''; document.getElementById('eventTime').value=''; document.getElementById('eventLocation').value=''; document.getElementById('eventEmoji').value='';
      renderEvents();
      generateCalendar();
    }

    function editEvent(id) {
      const evs = getEvents();
      const idx = evs.findIndex(e=>e.id===id);
      if (idx === -1) return;
      const e = evs[idx];
      const title = prompt('Title:', e.title);
      if (title === null) return;
      const date = prompt('Date (YYYY-MM-DD):', e.date);
      if (date === null) return;
      const time = prompt('Time (HH:MM):', e.time || '');
      if (time === null) return;
      const location = prompt('Location:', e.location || '');
      if (location === null) return;
      const emoji = prompt('Emoji:', e.emoji || '');
      if (emoji === null) return;
      e.title = title.trim(); e.date = date.trim(); e.time = time.trim(); e.location = location.trim(); e.emoji = emoji.trim();
      setEvents(evs);
      renderEvents();
      generateCalendar();
      if (selectedDay) showReminders(selectedDay);
    }

    function deleteEvent(id) {
      if (!confirm('Delete this event?')) return;
      let evs = getEvents();
      evs = evs.filter(e=>e.id!==id);
      setEvents(evs);
      renderEvents();
      generateCalendar();
      if (selectedDay) showReminders(selectedDay);
    }

    // --- UTILITIES ---
    function escapeHTML(s) {
      return (s+'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // Init
    (function init() {
      const now = new Date();
      selectedMonth = now.getMonth();
      selectedYear = now.getFullYear();
      selectedDay = now.getDate();
      generateCalendar();
      showReminders(selectedDay);
      loadTasks();
      renderEvents();
    })();
  </script>
</body>
</html>
