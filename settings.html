<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./app.css" />
  <style>
    /* ADDED: center only the User Profile and Jobs headings on settings page */
    #userProfile h3, #userJobs h3 { text-align: center; }
  </style>
</head>
<body>
  <header id="appHeader">ğŸ“… TimeScape Planner</header>

  <main style="max-width:640px;margin:18px auto;padding:12px;">
    <h2 style="text-align:center">Settings</h2>

    <!-- User Profile -->
    <section id="userProfile" style="margin-top:12px">
      <h3>User Profile</h3>

      <label for="userName" style="display:block;font-weight:600;margin-top:8px">Name</label>
      <input id="userName" type="text" placeholder="Your name" />

      <!-- ADDED: profile status indicator -->
      <div id="profileStatus" style="margin-top:6px;color:#666;font-size:0.95rem">Name not set</div>

      <label for="userHome" style="display:block;font-weight:600;margin-top:8px">Home address</label>
      <div class="places-suggestions" style="position:relative">
        <input id="userHome" type="text" placeholder="Enter your home address" autocomplete="off" />
        <div id="userHomeList" class="suggestions-list" style="display:none"></div>
      </div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveProfileBtn" class="small-btn" style="background:#4a90e2;color:#fff">Save profile</button>
        <button id="clearProfileBtn" class="small-btn">Clear</button>
      </div>

      <p style="margin-top:8px;color:#666">Home directions: <a id="homeDirections" href="#" target="_blank" rel="noopener">not set</a></p>
    </section>

    <!-- Jobs -->
    <section id="userJobs" style="margin-top:18px">
      <h3>Jobs</h3>

      <!-- Saved Jobs -->
      <div id="savedJobs" style="margin-top:8px">
        <h4>Saved Jobs</h4>
        <ul id="jobList" style="list-style:none;padding:0;margin:8px 0;">
          <!-- ... populated by JS ... -->
        </ul>
      </div>

      <!-- Add / Edit Job -->
      <div id="addJob" style="margin-top:16px">
        <h4>Add Job</h4>
        <input id="jobId" type="hidden" />
        <label for="jobName" style="display:block;margin-top:6px;font-weight:600">Job name</label>
        <input id="jobName" type="text" placeholder="e.g. Lawn mowing" />

        <label for="jobEmoji" style="display:block;margin-top:6px;font-weight:600">Emoji</label>
        <input id="jobEmoji" type="text" placeholder="e.g. ğŸšœ" />

        <label for="jobLocation" style="display:block;margin-top:6px;font-weight:600">Location</label>
        <div class="places-suggestions" style="position:relative">
          <input id="jobLocation" type="text" placeholder="Address or area" autocomplete="off" />
          <div id="jobLocationList" class="suggestions-list" style="display:none"></div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1">
            <label for="jobRate" style="display:block;font-weight:600">Rate</label>
            <input id="jobRate" type="text" placeholder="e.g. 25.00" />
          </div>
          <div style="width:140px">
            <label for="jobUnit" style="display:block;font-weight:600">Unit</label>
            <select id="jobUnit">
              <option value="hour">hour</option>
              <option value="job">job</option>
              <option value="day">day</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="saveJobBtn" class="small-btn" style="background:#4a90e2;color:#fff">Save job</button>
          <button id="clearJobBtn" class="small-btn">Clear</button>
        </div>
      </div>
    </section>

    <!-- Maps API Key settings (kept) -->
    <section id="mapsSettings" style="margin-top:18px">
      <h3>Google Maps</h3>
      <label for="mapsKeyInput" style="display:block;font-weight:600">Google Maps API Key</label>
      <input id="mapsKeyInput" type="text" placeholder="Enter Maps API key (stored in localStorage)" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveMapsKeyBtn" class="small-btn" style="background:#4a90e2;color:#fff">Save key</button>
        <button id="clearMapsKeyBtn" class="small-btn">Clear key</button>
        <button id="testMapsKeyBtn" class="small-btn">Load Maps Now</button>
      </div>
      <p id="mapsKeyNotice" style="margin-top:8px;color:#666;font-size:0.95rem">Saved key: <span id="mapsKeyDisplay">none</span></p>
    </section>
  </main>

  <nav class="bottom-ribbon" role="navigation" aria-label="App pages">
    <a href="#events" class="r-item" data-view="events"><span>ğŸ“…</span><span class="r-label">Events</span></a>
    <a href="#reminders" class="r-item" data-view="reminders"><span>ğŸ””</span><span class="r-label">Reminders</span></a>
    <a href="#calendar" class="r-item r-center" data-view="calendar"><span>ğŸ—“ï¸</span><span class="r-label">Calendar</span></a>
    <a href="#tasks" class="r-item" data-view="tasks"><span>âœ…</span><span class="r-label">Tasks</span></a>
    <a href="#settings" class="r-item" data-view="settings"><span>âš™ï¸</span><span class="r-label">Settings</span></a>
  </nav>

  <!-- Ensure clicking ribbon on this standalone page loads the fresh index.html (cache-busting).
       If already on index.html we only change the hash to keep SPA behavior. -->
  <script>
    (function () {
      const items = document.querySelectorAll('.bottom-ribbon .r-item');
      if (!items || !items.length) return;
      const now = Date.now();
      items.forEach(a => {
        const view = a.dataset.view || (a.getAttribute('href') || '').replace('#', '') || 'calendar';
        a.setAttribute('href', 'index.html?_=' + now + '#' + view);
      });
      items.forEach(a => {
        a.addEventListener('click', (e) => {
          const path = location.pathname.split('/').pop();
          const view = a.dataset.view || (a.getAttribute('href') || '').split('#')[1] || 'calendar';
          if (path === '' || path === 'index.html') {
            e.preventDefault();
            if (location.hash.replace('#','') !== view) {
              location.hash = view;
              window.dispatchEvent(new Event('hashchange'));
            } else {
              window.dispatchEvent(new Event('hashchange'));
            }
            return;
          }
          // not on index -> navigate to cache-busted index.html (href was already set)
          // allow default behavior
        }, { passive: true });
      });
    })();
  </script>

  <script src="./app.js"></script>
  <!-- ADDED: same wiring used in index to keep header/profile status in sync -->
  <script src="./events-view.js"></script>
</body>
</html>
